# EDA-анализ транзакций для выявления мошенничества

Этот проект представляет собой подробное исследование анонимизированного набора данных с финансовыми транзакциями. Цель — выявить закономерности, связанные с мошенническими операциями, и подготовить основу для построения антифрод-моделей. Анализ проводился в Jupyter/Google Colab, использовались только open-source инструменты Python.

## Исходные данные

### Основной датасет

- `transaction_fraud_data.parquet` — 7.48 млн транзакций с меткой `is_fraud`.
- Каждая запись включает характеристики транзакции: сумма, валюта, устройство, канал, карта, страна, город, поведенческая активность и др.
- Размер данных \~300 MB.

### Валютные курсы

- `historical_currency_exchange.parquet` — курс валют к доллару США по дням.
- Используется для нормализации признака `amount` (перевод в `usd_amount`).

---

## Цели анализа

1. Выполнить первичный обзор и очистку данных;
2. Понять распределения признаков и их связь с меткой `is_fraud`;
3. Проверить гипотезы о поведении мошенников: время, устройства, география, суммы;
4. Выделить фичи с высокой предиктивной способностью для последующего моделирования.

---

## Последовательность действий

### 1. Обзор и изучение структуры

На первом этапе мы ознакомились с данными, их структурой и основными характеристиками. Использовали методы:

- `df.info()` — чтобы понять типы данных, объем памяти;
- `df.head()` — первые строки таблицы;
- `df.describe()` — базовая статистика.

**Ключевые выводы:**

- Всего: 7.48 млн транзакций;
- 4869 уникальных клиентов;
- Почти все транзакции совершаются из одного города — `Unknown City`, что усложняет геоанализ.

### 2. Очистка и предобработка

Мы:

- Исключили `Unknown City` из анализа городов;
- Проверили отсутствие нулевых и отрицательных значений суммы;
- Распаковали столбец `last_hour_activity`, получив поведенческие признаки.

Эти признаки отражают, **что делал клиент за последний час до транзакции**, например:

- Сколько операций он уже совершил (`lha_num_tx`);
- Сколько уникальных продавцов и стран было (`lha_unique_merchants`, `lha_unique_countries`).

### 3. Обогащение данных

Мы создали:

- `usd_amount` — сумму в долларах США, объединив данные с курсами валют;
- `log_amount = log1p(usd_amount)` — логарифм суммы: он помогает снизить влияние выбросов;
- `is_night`, `is_weekend` — бинарные признаки для времени.

> Почему логарифм? Например, суммы в \$1 и \$1 000 000 дико отличаются, и график будет «смазан». Логарифм позволяет сжать такие различия и легче визуализировать тренды.

---

## Анализ признаков

### 4. Сумма транзакции

Фродовые транзакции в среднем крупнее:

- Среднее значение: \$118 000 против \$30 000;
- Медиана: \$5 600 против \$900;
- Стандартное отклонение (разброс): выше у фрода.

**Вывод:** мошенники часто совершают более крупные переводы.

### 5. Время

- Доля фрода ночью: **46.9%**;
- Днём: **12.2%**;
- Выходные и будни почти не отличаются (оба по 20%).

**Вывод:** ночное время — потенциально опасный интервал.

### 6. География

- Вне страны клиента фрод — **57%**;
- Внутри — только **2.5%**.

**Вывод:** резкое изменение страны может сигнализировать о риске.

### 7. Канал и устройство

- Каналы:

  - POS — 100% фрод (возможно, из-за генерации данных);
  - mobile/web — \~12% фрод.

- Устройства:

  - `Chip Reader`, `NFC`, `Magnetic Stripe` — 100% фрод;
  - Браузеры и приложения — 12–13%.

**Вывод:** тип устройства и канал важны для скоринга.

### 8. Карта и присутствие

- `is_card_present = False` — больше фрода;
- `Platinum Credit` — немного выше риск.

**Вывод:** онлайн-платежи более подвержены фроду.

### 9. Поведение клиента (last\_hour\_activity)

- Среднее количество транзакций за час — 400+;
- У мошенников максимум достигает **3854 транзакций за час.**

Мы рассмотрели клиентов, которые совершают необычно много операций за один час. Например, если кто-то совершает более 900 транзакций за час — это редкое поведение и потенциальный сигнал риска.

**Вывод:** можно строить правила на основе порогов активности (например, если клиент ведёт себя слишком активно — возможно, это фрод).

---

## Гипотезы

### Продуктовые:

1. Фрод чаще происходит ночью (0–6 часов);
2. Фрод чаще вне страны клиента;
3. Если клиент очень активен в течение одного часа — риск высокий;
4. POS-транзакции требуют отдельной обработки.

### Технические:

1. Использование `log(usd_amount)` улучшает стабильность модели;
2. География (`is_outside_home_country`), канал, устройство — мощные предикторы;
3. Поведенческие признаки (tx/hour, max amount/hour) важны и должны быть нормированы;
4. Можно использовать квантильные отсечки как фичи или для правила фильтрации.

---

## Инструменты

- `pandas`, `numpy`, `pyarrow` — работа с таблицами;
- `matplotlib`, `seaborn` — графики, гистограммы, боксплоты;
- `datetime`, `math` — преобразование времени, логарифмы.

---

## Структура проекта

```
fraud-eda/
├── README.md                         # Подробное описание проекта
├── Свободное_исследование.ipynb     # EDA-ноутбук
├── requirements.txt                  # Зависимости
└── data/                             # Файлы .parquet
```

---

## Заключение

Фрод можно распознать не только по сумме, но и по поведенческому и контекстному профилю:

- Когда совершена транзакция (ночью/днём);
- Где — в домашней стране или за рубежом;
- Через какое устройство и канал;
- Насколько активен клиент в течение часа.

Проект помог выделить фичи и закономерности, на которых можно строить антифрод-модель. Следующий этап — построение baseline-модели и анализ её качества.

